<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>第四环节·群英舌战</title>
    <link href="../static/css/bootstrap.css" rel="stylesheet"/>
    <style type="text/css">
        body {
            background: #2E2E2E;
            color: white;
        }

        .body-s {
            width: 100%;

        }

        .t-1 {
            color: red;
            float: left;
            margin-left: 80px;
            margin-top: 100px;

        }

        .t-2 {
            color: blue;
            float: left;
            margin-left: 80px;
            margin-top: 140px;
        }

        .div-1,
        .div-2 {
            width: 70%;
            text-align: center;
            margin: 0 auto;
        }

        .div-1 .test-img img {
            display: inline-block;
            max-width: 110%;
            width: 200px;
            height: 200px;
            padding: 1.5px;
            line-height: 1.42857143;
            /* border: 4px solid red; */
            border-radius: 6px;
            -webkit-transition: all .2s ease-in-out;
            -o-transition: all .2s ease-in-out;
            transition: all .2s ease-in-out;
            margin: 60px auto 100px auto;
        }

        .div-2 .test-img img {
            display: inline-block;
            max-width: 110%;
            width: 200px;
            height: 200px;
            padding: 1.5px;
            line-height: 1.42857143;
            /*border: 4px solid blue;*/
            border-radius: 6px;
            -webkit-transition: all .2s ease-in-out;
            -o-transition: all .2s ease-in-out;
            transition: all .2s ease-in-out;
            margin: 100px auto 40px auto;
        }

        .header-s {
            text-align: center;
        }

        .border1 {
            transform: scale(1.2);
        }
    </style>
</head>
<body>
<div>
    <div class="body-s">
        <div class="t-1">
            <h1>正方</h1>
        </div>
        <div class="div-1 row">
            <div th:each="r:${list}" class="col-md-2 col-sm-2 col-xs-6">
                <div th:if="${r.competitionOrder le 6}" class="test-img">
                    <img th:class="${r.userPersonsName}" th:src="${r.photoUrl}">
                </div>
            </div>
        </div>
    </div>
    <div class="header-s">
        <h2><span id="t-3"></span></h2>
        <h2><span id="t-4"></span></h2>
    </div>
    <div class="body-s">
        <div class="t-2">
            <h1>反方</h1>
        </div>
        <div class="div-2 row">
            <div th:each="l:${list}" class="col-md-2 col-sm-2 col-xs-6">
                <div th:if="${l.competitionOrder gt 6}" class="test-img">
                    <img th:class="${l.userPersonsName}" th:src="${l.photoUrl}">
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script src="../static/jquery-3.3.1.min.js"></script>
<script src="../static/bootstrap.js"></script>
<script src="../static/layui.all.js"></script>
<script>
    // var webSocketUrl = "ws://10.2.51.69:8088/websocket/";
    // var webSocketUrl = "ws://10.2.135.10:8088/websocket/publicscreen";
    var webSocketUrl = "ws://10.2.51.69:8088/websocket/publicscreen";
    var socket = new WebSocket(webSocketUrl);
    ;!function () {
        var layer = layui.layer,
            form = layui.form,
            util = layui.util,
            $ = layui.$;


        //连接到websocket
        //获得消息事件
        socket.onmessage = function (msg) {
            console.log(msg.data);
            if (msg.data !== "连接成功") {
                // 解析JSON串
                //{"fromUserId":"admin","message":{"currentLinksName":"第四环节、正方一辩","thisLinks":4,"userSortnum":1,"isQuartz":"否","sortNum":71,"id":70,"isEnable":"是"},"toUserId":"all"}
                var data = JSON.parse(msg.data);
                if (data.message.userSortnum !== -1) {
                    $.ajaxSettings.async = false;
                    $.post("/argue-id", {'id': data.message.userSortnum}, function (result) {
                        if (result.status === 200) {
                            $("img").removeClass("border1");
                            // 改变图片大小
                            $("." + result.data.userPersonsName).addClass("border1");
                            //1. js获取当bai前时间
                            var date = new Date();
                            var min = date.getMinutes();
                            //3. 设置当前时间+5分钟：把zhi当前分钟数+5后的值重新设置为date对象的分钟数
                            date.setMinutes(min + 2);
                            // 设置开始时间和结束时间
                            var endTime = date.getTime();
                            var nowDate = new Date().getTime();
                            // 1.开始时间是当前时间，结束时间是数据库的时间*5分钟
                            util.countdown(endTime, nowDate, function (date, nowDate, timer) {
                                // 1. 如果加的五分钟小于当前时间
                                var str = date[2] + '分' + date[3] + '秒';
                                $('#t-4').html('倒计时：' + str);
                                if (endTime <= nowDate) {
                                    clearInterval(timer);
                                    $("." + result.data.userPersonsName).removeClass("border1");
                                }
                            });
                            // 改变字体颜色
                            if (result.data.userId <= 6) {
                                $('#t-3').html('正方' + result.data.competitionOrder + '辩：' + result.data.userPersonsName);
                                $('#t-3').css("color", "red");
                            } else {
                                var n = 6;
                                var m = parseInt(result.data.competitionOrder);
                                var mn = m - n;
                                $('#t-3').html('反方' + mn + '辩：' + result.data.userPersonsName);
                                $('#t-3').css("color", "blue");

                            }
                        }
                    }, "json");
                    $.ajaxSettings.async = true;
                }

                //{"fromUserId":"admin","message":{"currentLinksName":"第四环节、开始公布成绩","thisLinks":4,"userSortnum":-1,"isQuartz":"否","sortNum":98,"id":97,"remarks":"攻辩过程完毕后，主持人示意评委进行评分，随后公布得分","isEnable":"是"},"toUserId":"all"}
                if (data.message.userSortnum === -1 && data.message.thisLinks === 4) {
                    // 跳转到得分页面
                    window.location.href = "/score?thisLinks="+data.message.userSortnum+"&userSortnum="+data.message.userSortnum;
                }
            }

        };
        //关闭事件
        socket.onclose = function () {
            console.log("websocket已关闭");

        };
        //发生了错误事件
        socket.onerror = function () {
            console.log("websocket发生了错误");
        }


    }();


</script>
</html>
